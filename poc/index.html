<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste POC.js</title>
    <style>
        body {
            background-color: white;
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        #output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .notes {
            background-color: #e7f3fe;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin: 20px 0;
        }
        
        .notes h3 {
            margin-top: 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste POC.js</h1>
        
        <div class="notes">
            <h3>‚ö†Ô∏è Observa√ß√µes Importantes:</h3>
            <p>Este c√≥digo provavelmente <strong>n√£o funcionar√°</strong> devido a:</p>
            <ul>
                <li>Depend√™ncias ausentes (wasm-module-builder.js)</li>
                <li>APIs experimentais n√£o suportadas</li>
                <li>Limita√ß√µes do ambiente de execu√ß√£o</li>
                <li>Poss√≠veis restri√ß√µes de seguran√ßa do navegador</li>
            </ul>
        </div>
        
        <button id="runButton" onclick="runPoc()">Executar POC.js</button>
        
        <div id="status"></div>
        
        <h3>Sa√≠da do Console:</h3>
        <div id="output">Nenhuma execu√ß√£o realizada ainda.</div>
        
        <h3>Detalhes do C√≥digo:</h3>
        <pre><code id="codePreview">Carregando...</code></pre>
    </div>

    <script>
        // Previsualizar o c√≥digo
        document.addEventListener('DOMContentLoaded', function() {
            fetch('poc.js')
                .then(response => response.text())
                .then(code => {
                    document.getElementById('codePreview').textContent = 
                        code.substring(0, 1000) + (code.length > 1000 ? '\n\n[... c√≥digo truncado ...]' : '');
                })
                .catch(error => {
                    document.getElementById('codePreview').textContent = 
                        'Erro ao carregar poc.js: ' + error.message;
                });
        });
        
        // Capturar logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        let outputDiv = document.getElementById('output');
        let logs = [];
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logs.push('[LOG] ' + args.join(' '));
            updateOutput();
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logs.push('[ERRO] ' + args.join(' '));
            updateOutput();
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logs.push('[AVISO] ' + args.join(' '));
            updateOutput();
        };
        
        function updateOutput() {
            outputDiv.textContent = logs.join('\n');
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateOutput();
        }
        
        function showStatus(message, type) {
            let statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
            statusDiv.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        async function runPoc() {
            const button = document.getElementById('runButton');
            button.disabled = true;
            button.textContent = 'Executando...';
            clearLogs();
            hideStatus();
            
            try {
                console.log('üöÄ Iniciando execu√ß√£o do POC.js...');
                console.log('üìÖ Data/hora: ' + new Date().toLocaleString());
                
                // Tenta carregar o wasm-module-builder.js primeiro
                console.log('üì¶ Tentando carregar depend√™ncias...');
                
                // Tenta carregar e executar o poc.js
                const response = await fetch('poc.js');
                if (!response.ok) {
                    throw new Error(`Falha ao carregar poc.js: ${response.status}`);
                }
                
                const pocCode = await response.text();
                console.log('‚úÖ poc.js carregado (' + pocCode.length + ' bytes)');
                
                // Verifica depend√™ncias
                if (!pocCode.includes('load("wasm-module-builder.js")')) {
                    console.warn('‚ö†Ô∏è  O c√≥digo n√£o parece carregar wasm-module-builder.js');
                } else {
                    console.log('üîç C√≥digo referencia wasm-module-builder.js');
                }
                
                // Tenta carregar o wasm-module-builder.js se existir
                try {
                    const builderResponse = await fetch('wasm-module-builder.js');
                    if (builderResponse.ok) {
                        const builderCode = await builderResponse.text();
                        console.log('‚úÖ wasm-module-builder.js carregado (' + builderCode.length + ' bytes)');
                        
                        // Avalia o builder primeiro
                        eval(builderCode);
                        console.log('‚úÖ wasm-module-builder.js executado');
                        
                        // Agora executa o POC
                        eval(pocCode);
                        console.log('‚úÖ POC.js executado com sucesso!');
                        showStatus('Execu√ß√£o conclu√≠da com sucesso!', 'success');
                    } else {
                        console.error('‚ùå wasm-module-builder.js n√£o encontrado');
                        console.warn('‚ö†Ô∏è  Executando apenas o POC.js sem depend√™ncias...');
                        
                        // Remove a linha de load() e tenta executar
                        const modifiedCode = pocCode.replace(/load\("wasm-module-builder\.js"\);/, '// load() removido');
                        eval(modifiedCode);
                        console.log('‚úÖ POC.js executado (sem depend√™ncias)');
                        showStatus('Executado sem depend√™ncias - poss√≠veis erros esperados', 'warning');
                    }
                } catch (builderError) {
                    console.error('‚ùå Erro ao carregar wasm-module-builder.js:', builderError.message);
                    console.warn('‚ö†Ô∏è  Tentando executar POC.js sem depend√™ncias...');
                    
                    // Tenta executar mesmo sem o builder
                    const modifiedCode = pocCode.replace(/load\("wasm-module-builder\.js"\);/, '');
                    eval(modifiedCode);
                    showStatus('Executado com limita√ß√µes - algumas fun√ß√µes podem falhar', 'warning');
                }
                
            } catch (error) {
                console.error('üí• ERRO CR√çTICO:', error.message);
                console.error('Stack trace:', error.stack);
                showStatus('Erro durante execu√ß√£o: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'Executar POC.js';
                console.log('üèÅ Execu√ß√£o finalizada.');
            }
        }
        
        // Verifica se os arquivos existem
        document.addEventListener('DOMContentLoaded', function() {
            fetch('poc.js')
                .then(response => {
                    if (!response.ok) {
                        document.getElementById('output').textContent = 
                            'ERRO: Arquivo poc.js n√£o encontrado!\nColoque este HTML na mesma pasta que poc.js e wasm-module-builder.js';
                    }
                })
                .catch(() => {
                    document.getElementById('output').textContent = 
                        'ERRO: N√£o foi poss√≠vel verificar os arquivos.';
                });
        });
    </script>
</body>
</html>
