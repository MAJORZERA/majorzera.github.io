<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste POC.js</title>
    <style>
        body {
            background-color: white;
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px 5px 20px 0;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        #status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        #output {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            min-height: 100px;
        }
        
        .notes {
            background-color: #e7f3fe;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin: 20px 0;
        }
        
        .notes h3 {
            margin-top: 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Teste POC.js</h1>
        
        <div class="notes">
            <h3>‚ö†Ô∏è Observa√ß√µes:</h3>
            <p>Este c√≥digo usa fun√ß√µes espec√≠ficas do JavaScriptCore que podem n√£o funcionar em navegadores.</p>
        </div>
        
        <button id="runButton" onclick="runPoc()">Executar POC.js</button>
        
        <div id="status"></div>
        
        <h3>Sa√≠da do Console:</h3>
        <div id="output">Clique no bot√£o para executar o c√≥digo...</div>
    </div>

    <script>
        // Capturar logs
        const outputDiv = document.getElementById('output');
        let logs = [];
        
        // Substituir fun√ß√µes do console para capturar output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logs.push('[LOG] ' + args.join(' '));
            updateOutput();
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logs.push('[ERRO] ' + args.join(' '));
            updateOutput();
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logs.push('[AVISO] ' + args.join(' '));
            updateOutput();
        };
        
        function updateOutput() {
            outputDiv.textContent = logs.join('\n');
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        function clearLogs() {
            logs = [];
            updateOutput();
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = type;
            statusDiv.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        // Emular fun√ß√µes faltantes do JavaScriptCore
        function setupCompatibility() {
            // Emular load() se n√£o existir
            if (typeof load === 'undefined') {
                window.load = function(filename) {
                    console.log(`[EMULA√á√ÉO] Tentando carregar: ${filename}`);
                    
                    return new Promise(async (resolve, reject) => {
                        try {
                            const response = await fetch(filename);
                            if (!response.ok) {
                                throw new Error(`Arquivo n√£o encontrado: ${filename}`);
                            }
                            const code = await response.text();
                            eval(code);
                            console.log(`[EMULA√á√ÉO] ${filename} carregado`);
                            resolve();
                        } catch (error) {
                            console.error(`[EMULA√á√ÉO] Falha ao carregar ${filename}:`, error.message);
                            reject(error);
                        }
                    });
                };
            }
            
            // Emular gc() se n√£o existir
            if (typeof gc === 'undefined') {
                window.gc = function() {
                    console.log('[EMULA√á√ÉO] Coleta de lixo solicitada');
                    // Tentar for√ßar garbage collection
                    if (window.gc) {
                        return window.gc();
                    }
                    // M√©todo alternativo
                    try {
                        if (window.PerformanceObserver) {
                            new PerformanceObserver(() => {}).observe({type: 'gc'});
                        }
                    } catch (e) {}
                };
            }
            
            // Emular print() se n√£o existir
            if (typeof print === 'undefined') {
                window.print = function(...args) {
                    console.log('[PRINT]', ...args);
                };
            }
        }
        
        async function runPoc() {
            const button = document.getElementById('runButton');
            button.disabled = true;
            button.textContent = 'Executando...';
            
            clearLogs();
            hideStatus();
            
            console.log('üöÄ Iniciando execu√ß√£o do POC.js...');
            console.log('üìÖ ' + new Date().toLocaleString());
            
            try {
                // Configurar compatibilidade
                setupCompatibility();
                
                // Verificar se o arquivo existe
                const response = await fetch('poc.js');
                if (!response.ok) {
                    throw new Error(`Arquivo poc.js n√£o encontrado (status: ${response.status})`);
                }
                
                const pocCode = await response.text();
                console.log('‚úÖ poc.js carregado (' + pocCode.length + ' bytes)');
                
                // Tentar carregar wasm-module-builder.js se mencionado
                if (pocCode.includes('wasm-module-builder.js')) {
                    console.log('üîç Detectada refer√™ncia a wasm-module-builder.js');
                    
                    try {
                        const builderResponse = await fetch('wasm-module-builder.js');
                        if (builderResponse.ok) {
                            const builderCode = await builderResponse.text();
                            console.log('‚úÖ wasm-module-builder.js carregado');
                            
                            // Executar o builder primeiro
                            eval(builderCode);
                            console.log('‚úÖ Depend√™ncias carregadas');
                        } else {
                            console.warn('‚ö†Ô∏è wasm-module-builder.js n√£o encontrado');
                            console.warn('‚ö†Ô∏è Algumas funcionalidades podem n√£o estar dispon√≠veis');
                        }
                    } catch (builderError) {
                        console.warn('‚ö†Ô∏è Erro ao carregar depend√™ncias:', builderError.message);
                    }
                }
                
                // Executar o c√≥digo principal
                console.log('‚ö° Executando c√≥digo principal...');
                eval(pocCode);
                
                console.log('‚úÖ Execu√ß√£o conclu√≠da com sucesso!');
                showStatus('Execu√ß√£o conclu√≠da!', 'success');
                
            } catch (error) {
                console.error('üí• ERRO durante execu√ß√£o:', error.message);
                console.error('Stack trace:', error.stack);
                showStatus('Erro: ' + error.message, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'Executar POC.js';
                console.log('üèÅ Fim da execu√ß√£o');
            }
        }
        
        // Verificar se o arquivo existe ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            fetch('poc.js')
                .then(response => {
                    if (!response.ok) {
                        outputDiv.textContent = 
                            '‚ùå ERRO: Arquivo poc.js n√£o encontrado!\n\n' +
                            'Certifique-se de que este arquivo HTML est√° na mesma pasta que:\n' +
                            '1. poc.js\n' +
                            '2. wasm-module-builder.js (opcional)';
                    }
                })
                .catch(() => {
                    outputDiv.textContent = '‚ùå N√£o foi poss√≠vel verificar os arquivos.';
                });
        });
    </script>
</body>
</html>
